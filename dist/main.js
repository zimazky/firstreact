(()=>{"use strict";class e{constructor(e){this.url=e}getInfo(e=(e=>{}),t=(e=>{})){return fetch(this.url+"/?g:i&r="+Math.random()).then((e=>e.text())).then((t=>e(t))).catch((e=>{console.log("ArduinoController not available"),t(e)}))}setTemperature(e,t,a=(()=>{}),s=(()=>{})){return fetch(this.url+"/?s"+e+"t:"+Math.round(10*t)+"&r="+Math.random()).then((()=>{console.log("ArduinoController set temperature"),a()})).catch((()=>{console.log("ArduinoController set temperature failure"),s()}))}powerOn(e,t=(()=>{}),a=(()=>{})){return fetch(this.url+"/?s"+e+"m:1&r="+Math.random()).then((()=>{console.log("Power On",e),t()})).catch((()=>{console.log("Power On failure"),a()}))}powerOff(e,t=(()=>{}),a=(()=>{})){return fetch(this.url+"/?s"+e+"m:0&r="+Math.random()).then((()=>{console.log("Power Off",e),t()})).catch((()=>{console.log("Power Off failure"),a()}))}static parseInfo(e){const t=e.split(";"),[a,s,i,r,n,o,l,h,c,...u]=t;return{version:"ver."+a,numofz:+s,unixtime:+i,starttime:+r,lastsynctime:+n,lastsyncdelta:+o,lastsyncinterval:+l,tickcounter:+h,loopcounter:+c,zones:function e(t,a=[],s=0){if(!t.length)return a;const[i,...r]=t;switch(i){case"Z":{const[t,s,n,o,l,h,c,u,...m]=r;return a.push({type:i,id:+t,temperature:+s/10,targetTemperature:+n/10,humidity:+o/10,onControl:+l,powerOn:+h,targetTemperatureDelta:+c/10,sensorState:+u}),e(m,a,+t)}case"H":{const[t,s,n,o,l,h,c,u,m,...d]=r;return a.push({type:i,id:+t,pressure:5*(10*+s-1023)/8184,mode:+n,hilimit:+o,lolimit:+l,drylimit:+h,pumpinittime:+c,pumprunlimit:+u,retryinterval:+m}),e(d,a,+t)}case"I":{const[t,s,n,o,l,h,...c]=r,[u,m,d]=[+n,+o,+l],g=[255&u,u>>8&255,u>>16&255,u>>24&255],p=[255&m,m>>8&255,m>>16&255,m>>24&255],f=[255&d,d>>8&255,d>>16&255,d>>24&255];return a.push({type:i,id:+t,poweron:+s,start:g,duration:p,days:f,mduration:+h}),e(c,a,+t)}}return a}(u)}}}e.states=["OK","ErrChecksum","ErrTimeout","ErrConnect","ErrAckL","ErrAckH","ErrUnknown"],e.sensorState=t=>e.states[-t];class t{static initLocale(e=3,a=1){t.timezone=e,t.startWeek=a%7}static getUTCYearMonthDay(e){const t=Math.floor(e/86400),a=Math.floor((400*t+200)/146097);let s=1970+a;const i=s-2e3-1;let r=t-Math.floor((1461*a+1)/4);r+=Math.floor(i/100)-Math.floor(i/400);const n=(s%4||!(s%100))&&s%400?0:1;r>58+n&&(r+=2-n);let o=Math.floor((12*r+6)/367);const l=r-Math.floor((367*o+5)/12);return o<0&&(s--,o+=12),o>11&&(s++,o-=12),{year:s,month:o,day:l+1}}static getYearMonthDay(e){return t.getUTCYearMonthDay(e+3600*t.timezone)}static YYYYMMDDToTimestampUTC(e){let[t,a,s]=e.split(".",3);void 0===a&&([t,a,s]=e.split("-",3));const i=+t,r=+a-1,n=(i%4||!(i%100))&&i%400?0:1;let o=Math.floor((367*r+5)/12)+ +s-1;o>59+n&&(o-=2-n);const l=i-1970,h=i-2e3-1;let c=Math.floor((1461*l+1)/4);return c-=Math.floor(h/100)-Math.floor(h/400),c+=o,isNaN(c)?(console.log(`Ошибка преобразования строки '${e}' формата 'YYYY.MM.DD' к unixtime`),0):86400*c}static YYYYMMDDToTimestamp(e){return t.YYYYMMDDToTimestampUTC(e)-3600*t.timezone}static getWeekday(e){const a=(4+Math.floor((e+3600*t.timezone)/86400))%7;return e<0?0==a?0:a+7:a}static getDayMonthWeekday(e){const{month:a,day:s}=t.getYearMonthDay(e);return{day:s,month:a,weekday:t.getWeekday(e)}}static getBegintWeekTimestamp(e){const a=t.getBeginDayTimestamp(e);let s=t.getWeekday(e)-t.startWeek;return s<0&&(s+=7),a-86400*s}static getUTCBeginDayTimestamp(e){return 86400*Math.floor(e/86400)}static getBeginDayTimestamp(e){return 86400*Math.floor((e+3600*t.timezone)/86400)-3600*t.timezone}static getEndDayTimestamp(e){return t.getBeginDayTimestamp(e)+86399}static getUTCTime(e){return e<0?e%86400+86400:e%86400}static getTime(e){return t.getUTCTime(e+3600*t.timezone)}static getTimeToEndDay(e){return t.getEndDayTimestamp(e)-e}static getDifferenceInDays(e,a){return Math.floor((a-t.getBeginDayTimestamp(e))/86400)}static getUTCYYYYMMDD(e){const{year:a,month:s,day:i}=t.getUTCYearMonthDay(e),r=s+1;return a+(r>9?".":".0")+r+(i>9?".":".0")+i}static getYYYYMMDD(e){const{year:a,month:s,day:i}=t.getYearMonthDay(e),r=s+1;return a+(r>9?".":".0")+r+(i>9?".":".0")+i}static UTCYYYYMMDD(e){const{year:a,month:s,day:i}=t.getUTCYearMonthDay(e),r=s+1;return a+(r>9?"":"0")+r+(i>9?"":"0")+i}static YYYYMMDD(e){const{year:a,month:s,day:i}=t.getYearMonthDay(e),r=s+1;return a+(r>9?"":"0")+r+(i>9?"":"0")+i}static getUTCHoursMinutes(e){const a=t.getUTCTime(e);return{hours:Math.floor(a/3600),minutes:Math.floor(a%3600/60)}}static getHoursMinutes(e){const a=t.getTime(e);return{hours:Math.floor(a/3600),minutes:Math.floor(a%3600/60)}}static getUTCHHMM(e){const{hours:a,minutes:s}=t.getUTCHoursMinutes(e);return(a>9?"":"0")+a+(s>9?":":":0")+s}static getHHMM(e){const{hours:a,minutes:s}=t.getHoursMinutes(e);return(a>9?"":"0")+a+(s>9?":":":0")+s}static getUTCYYYYMMDDTHHMM(e){const{year:a,month:s,day:i}=t.getUTCYearMonthDay(e),{hours:r,minutes:n}=t.getUTCHoursMinutes(e),o=s+1;return a+(o>9?"-":"-0")+o+(i>9?"-":"-0")+i+(r>9?"T":"T0")+r+(n>9?":":":0")+n}static getYYYYMMDDTHHMM(e){const{year:a,month:s,day:i}=t.getYearMonthDay(e),{hours:r,minutes:n}=t.getHoursMinutes(e),o=s+1;return a+(o>9?"-":"-0")+o+(i>9?"-":"-0")+i+(r>9?"T":"T0")+r+(n>9?":":":0")+n}static secondsToHMM(e){const t=~~(e/3600),a=Math.abs(~~(e%3600/60));return t+(a>9?":":":0")+a}static HMMToSeconds(e){if(!e)return 0;const[t,a]=e.split(":",2),s=3600*+t,i=60*+a,r=s<0?s-i:s+i;return isNaN(r)||i<0?(console.log(`Ошибка преобразования строки '${e}' формата 'H:MM' к интервалу времени`),0):r}static secondsToDdHMM(e){const a=~~(e/86400),s=e%86400;return a>=1||a<=-1?a+"d "+t.secondsToHMM(Math.abs(s)):t.secondsToHMM(s)}static DdHMMToSeconds(e){const[a,s]=e.split("d",2);return void 0===s?t.HMMToSeconds(a):86400*+a+t.HMMToSeconds(s)}static isSameDay(e,a){return t.getBeginDayTimestamp(e)===t.getBeginDayTimestamp(a)}static isToday(e){return t.isSameDay(e,Date.now()/1e3)}}t.WEEKDAYS=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],t.MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t.MONTHS_FULL=["January","February","March","April","May","June","July","August","September","October","November","December"],t.startWeek=1,t.timezone=3,t.dateDelimiter=".";class a{constructor(e,t=8){this.queue=[],this.inProcess=[],this.onload=()=>{},this.loadNext=()=>{const e=this.queue.shift();void 0!==e&&(this.inProcess.push(e.name),fetch(this.url+e.name).then((e=>{if(e.ok)return e.text();throw Error(`status=${e.status}`)})).then((t=>e.resolve(t))).catch((t=>{console.log(`loading error ${e.name}: ${t.message}`),e.reject()})).finally((()=>{this.inProcess=this.inProcess.filter((t=>t!=e.name)),this.onload(),this.loadNext()})))},this.threadsLimit=t,this.queue=[],this.url=e}getLogByTimestamp(e,a,i,r=(()=>{})){if(a>t.getBeginDayTimestamp(Date.now()/1e3))return s.NotYet;const n=t.YYYYMMDD(a)+"."+e;return this.getLogByName(n,i,r)}getLogByName(e,t,a){if(this.queue.some((t=>t.name==e))||this.inProcess.includes(e))return s.Queued;for(this.queue.push({name:e,resolve:t,reject:a});this.queue.length>0&&this.inProcess.length<this.threadsLimit;)this.loadNext();return s.OK}}var s;!function(e){e[e.OK=0]="OK",e[e.Busy=1]="Busy",e[e.Queued=2]="Queued",e[e.NotYet=3]="NotYet"}(s||(s={}));class i{constructor(e,t="stepped"){this.data=[],this.flag=0,this.value=0,this.high=-Number.MAX_VALUE,this.low=Number.MAX_VALUE,this.open=0,this.close=0,this.topen=0,this.tclose=0,this.nclose=0,this.tstep=0,this.zdata=[],this.ohlcdata=[],this.hldata=[],this.time=e,this.zmode=t}push(e){if(!(e.time<this.time)){if(0==this.data.length)return this.flag=1,this.value=this.low=this.high=this.open=this.close=e.value,this.topen=this.tclose=e.time,void this.data.push({flag:0,time:e.time,value:e.value});this.tclose>this.topen&&(this.value=(this.value*(this.tclose-this.topen)+this.close*(e.time-this.tclose))/(e.time-this.topen)),this.close!=e.value||1!=e.flag?(this.low=Math.min(this.low,e.value),this.high=Math.max(this.high,e.value),this.close=e.value,this.tclose=e.time,this.nclose=0,this.data.push({flag:e.flag,time:e.time,value:e.value})):0==this.nclose?(this.nclose++,this.tclose=e.time,this.data.push({flag:e.flag,time:e.time,value:e.value})):(this.data[this.data.length-1].time=e.time,this.tclose=e.time)}}getlinearregdata(e){const t=[];let a=this.data[0],s=this.time,i=a.value;for(;s+e<a.time;)t.push({flag:0,value:i}),s+=e;t.push({flag:1,value:i});for(let r=1;r<this.data.length;r++){a=this.data[r];const n=t.length-1,o=this.data[r-1];if(a.time<s+e)t[n].value+=(a.value-i)*(s+e-a.time)/e,i=a.value;else{s+=e;const r=(a.value-o.value)/(a.time-o.time);for(i=o.value+r*(s-o.time);s+e<a.time;){const n=i+r*e;t.push({flag:a.flag,value:(i+n)/2}),i=n,s+=e}t.push({flag:1,value:i})}}return t}getsteppedregdata(e){const t=[];let a=this.data[0],s=this.time,i=a.value;for(;s+e<a.time;)t.push({flag:0,value:i}),s+=e;t.push({flag:1,value:i});for(let r=1;r<this.data.length;r++){a=this.data[r];const n=t.length-1,o=this.data[r-1];if(a.time<s+e)t[n].value+=(a.value-i)*(s+e-a.time)/e,i=a.value;else{for(s+=e,i=o.value;s+e<a.time;)t.push({flag:a.flag,value:i}),s+=e;0==a.flag&&(i=a.value),t.push({flag:1,value:i})}}return t.push({flag:1,value:i}),t}getohlcregdata(e){const t=[];let a=this.data[0],s=this.time,i=a.value;for(;s+e<a.time;)t.push({flag:0,open:i,high:i,low:i,close:i}),s+=e;t.push({flag:1,open:i,high:i,low:i,close:i});for(let r=1;r<this.data.length;r++){a=this.data[r];const n=t.length-1,o=this.data[r-1];if(a.time<s+e)t[n].close=a.value,t[n].high=a.value>t[n].high?a.value:t[n].high,t[n].low=a.value<t[n].low?a.value:t[n].low;else{for(s+=e,i=o.value;s+e<a.time;)t.push({flag:a.flag,open:i,high:i,low:i,close:i}),s+=e;0==a.flag&&(i=a.value),t.push({flag:1,open:i,high:i,low:i,close:i})}}return t.push({flag:1,open:i,high:i,low:i,close:i}),t}gethighlowregdata(e){const t=[];let a=this.data[0],s=this.time,i=a.value;for(;s+e<a.time;)t.push({flag:0,high:i,low:i}),s+=e;t.push({flag:1,high:i,low:i});for(var r=1;r<this.data.length;r++){a=this.data[r];const n=t.length-1,o=this.data[r-1];if(a.time<s+e)t[n].high=a.value>t[n].high?a.value:t[n].high,t[n].low=a.value<t[n].low?a.value:t[n].low;else{for(s+=e,i=o.value;s+e<a.time;)t.push({flag:a.flag,high:i,low:i}),s+=e;0==a.flag&&(i=a.value),t.push({flag:1,high:i,low:i})}}return t.push({flag:1,high:i,low:i}),t}rezoom(e){if(e<i.mintstep&&(e=i.mintstep),this.tstep!=e&&0!=this.data.length)switch(this.tstep=e,this.zmode){case"linear":this.zdata=this.getlinearregdata(e);break;case"stepped":this.zdata=this.getsteppedregdata(e);break;case"highlow":this.hldata=this.gethighlowregdata(e);break;case"ohlc":this.ohlcdata=this.getohlcregdata(e)}}static createzdata(e,t){const a={zdata:[],min:Number.MAX_VALUE,max:-Number.MAX_VALUE};t<i.mintstep&&(t=i.mintstep);for(let s=e.begin;s<e.end;s+=t)a.zdata.push({flag:0,value:0});return a}fillzdata(e,t,a){if(t<i.mintstep&&(t=i.mintstep),this.tclose<=e.begin||this.topen>=e.end)return a;this.rezoom(t);let s=e.begin,r=~~((e.begin-this.time)/t),n=0;for(r<0&&(s=this.time,n=-r,r=0);s<e.end&&s<this.tclose;r++,n++,s+=t){const e=this.zdata[r].flag;a.zdata[n].flag=e;const t=this.zdata[r].value;a.zdata[n].value=t,1==e&&(a.min=t<a.min?t:a.min,a.max=t>a.max?t:a.max)}return a}fillHLData(e,t,a){if(t<i.mintstep&&(t=i.mintstep),this.tclose<=e.begin||this.topen>=e.end)return a;this.rezoom(t);let s=e.begin,r=~~((e.begin-this.time)/t),n=0;for(r<0&&(s=this.time,n=-r,r=0);s<e.end&&s<this.tclose;r++,n++,s+=t){const e=this.hldata[r].flag;a.zdata[n].flag=e;const t=this.hldata[r].high,s=this.hldata[r].low;a.zdata[n].high=t,a.zdata[n].low=s,1==e&&(a.min=s<a.min?s:a.min,a.max=t>a.max?t:a.max)}return a}fillOHLCData(e,t,a){if(t<i.mintstep&&(t=i.mintstep),this.tclose<=e.begin||this.topen>=e.end)return a;this.rezoom(t);let s=e.begin,r=~~((e.begin-this.time)/t),n=0;for(r<0&&(s=this.time,n=-r,r=0);s<e.end&&s<this.tclose;r++,n++,s+=t){const e=this.ohlcdata[r].flag,t=this.ohlcdata[r].open,s=this.ohlcdata[r].high,i=this.ohlcdata[r].low,o=this.ohlcdata[r].close;a.zdata[n]={flag:e,open:t,high:s,low:i,close:o},1==e&&(a.min=i<a.min?i:a.min,a.max=s>a.max?s:a.max)}return a}integrate(e){let t=0;if(0==this.data.length)return t;let a=this.data[0];for(let s=1;s<this.data.length;s++){const i=this.data[s];i.time>e.begin&&i.time<=e.end&&(t+=a.value*(i.time-a.time),a=i)}return t}clearzdata(){this.zdata=[],this.hldata=[],this.ohlcdata=[],this.tstep=0}}i.mintstep=1;class r{constructor(e){this.pressure=new i(e),this.mode=new i(e)}push(e,t){void 0!==e.pressure&&this.pressure.push({flag:e.flag,value:e.pressure,time:t}),void 0!==e.mode&&this.mode.push({flag:1,value:e.mode,time:t})}}class n{constructor(){this.pdata=0,this.pressure=0,this.mode=0,this.hiLimit=0,this.loLimit=0,this.dryLimit=0,this.pumpInitTime=0,this.pumpRunLimit=0,this.retryInterval=0}parseEventOld(e){const t={},a=+e[0];let s=2;128&a&&(this.pdata=0),1&a&&(this.pdata+=+e[s++]),4&a&&(t.mode=this.mode=+e[s++]),8&a&&(t.hiLimit=this.hiLimit=+e[s++],t.loLimit=this.loLimit=+e[s++],t.dryLimit=this.dryLimit=+e[s++]),16&a&&(t.pumpInitTime=this.pumpInitTime=+e[s++],t.pumpRunLimit=this.pumpRunLimit=+e[s++],t.retryInterval=this.retryInterval=+e[s++]);let i=2&a?5*(this.pdata-102.3)/818.4:this.pdata/1e3;return i>=-1&&i<=6&&(t.flag=128&a?0:1,t.pressure=this.pressure=i),t}parseEvent(e,t){const a={};let s=0;2==e[0].length?s+=1:e[0]=e[0].slice(2);const i=+e[s++];128&i&&(this.pdata=0),1&i&&(this.pdata+=+e[s++]),4&i&&(a.mode=this.mode=+e[s++]),8&i&&(a.hiLimit=this.hiLimit=+e[s++],a.loLimit=this.loLimit=+e[s++],a.dryLimit=this.dryLimit=+e[s++]),16&i&&(a.pumpInitTime=this.pumpInitTime=+e[s++],a.pumpRunLimit=this.pumpRunLimit=+e[s++],a.retryInterval=this.retryInterval=+e[s++]);let r=2&i?5*(this.pdata-102.3)/818.4:this.pdata/1e3;return r>=-1&&r<=6&&(a.flag=128&i?0:1,a.pressure=this.pressure=r),[e.slice(s),a]}getLastData(){return{flag:1,pressure:this.pressure,mode:this.mode,hiLimit:this.hiLimit,loLimit:this.loLimit,dryLimit:this.dryLimit,pumpInitTime:this.pumpInitTime,pumpRunLimit:this.pumpRunLimit,retryInterval:this.retryInterval}}createLogDataSet(e){return new r(e)}}class o{constructor(e){this.loopcounter=new i(e)}push(e,t){void 0!==e.loopcounter&&this.loopcounter.push({flag:1,value:e.loopcounter,time:t})}}class l{constructor(){this.time=0,this.loopcounter=0}parseEventOld(e){128&+e[0]&&(this.time=0);let t=+e[1];return t=t>2147483647?t-4294967296:t,t<0&&console.log(t,this.time),this.time+=t,this.time}parseEvent(e,t){t&&(this.time=0,this.loopcounter=0);let a=0;1==e[0].length?a+=1:e[0]=e[0].slice(1);let s=+e[a++];return s=s>2147483647?s-4294967296:s,s<0&&console.log(s,this.time),this.time+=s,this.loopcounter+=+e[a++],[e.slice(3),{time:this.time,loopcounter:this.loopcounter}]}getLastData(){return{time:this.time,loopcounter:this.loopcounter}}getLastTime(){return this.time}createLogDataSet(e){return new o(e)}}class h{constructor(e,t,a,s,i){this.id=e,this.ext="H"+e,this.logLoader=t.logLoader,this.color=a,this.timeslots=[],this.begin=s,this.end=i}createEventParser(){return new n}getDataSet(e){return void 0===this.timeslots[e]&&(this.timeslots[e]=new r(e)),this.timeslots[e]}createDataSet(e){return void 0!==this.timeslots[e]?null:(this.timeslots[e]=new r(e),this.timeslots[e])}getParser(e){return{name:this.ext,parser:this.createEventParser(),dataset:this.getDataSet(e)}}load(e){e<this.begin||e>this.end||void 0!==this.timeslots[e]||this.logLoader.getLogByTimestamp(this.ext,e,(t=>{this.parseHydroLogData(t,e)}),(()=>{void 0===this.timeslots[e]&&(this.timeslots[e]=null)}))}getRegData(e,a,s){const r=i.createzdata(e,a);for(let i=t.getBeginDayTimestamp(e.begin);i<e.end;i+=86400)void 0===this.timeslots[i]?s(i):null!==this.timeslots[i]&&this.timeslots[i].pressure.fillzdata(e,a,r);return r}parseHydroLogData(e,t){const a=e.split("\n"),s=new l,i=new n,r=this.createDataSet(t);null!==r&&e&&a.forEach((e=>{const t=e.split(";");if(t.length<=2)return;const a=s.parseEventOld(t);if(0==a)return;const n=i.parseEventOld(t);r.push(n,a)}))}}class c{constructor(e){this.temperature=new i(e),this.humidity=new i(e),this.power=new i(e)}push(e,t){void 0!==e.temperature&&this.temperature.push({...e.temperature,time:t}),void 0!==e.humidity&&this.humidity.push({...e.humidity,time:t}),void 0!==e.power&&this.power.push({flag:1,value:e.power,time:t})}}class u{constructor(){this.temperature=0,this.humidity=0,this.targetTemperature=0,this.targetTemperatureDelta=0,this.power=0,this.mode=0,this.sensorState=0,this.f=0}parseEventOld(e){let t={};const a=+e[0];let s=2;if(128&a&&(this.temperature=0,this.humidity=0,t.power=this.power=4&a?1:0,t.mode=this.mode=8&a?1:0,this.targetTemperature=0,this.targetTemperatureDelta=0,this.sensorState=0),1&a&&(this.temperature+=+e[s++]),2&a&&(this.humidity+=+e[s++]),4&a?this.power||(t.power=this.power=1):this.power&&(t.power=this.power=0),8&a?this.mode||(t.mode=this.mode=1):this.mode&&(t.mode=this.mode=0),16&a&&(t.targetTemperature=this.targetTemperature=+e[s++]),32&a&&(t.targetTemperatureDelta=this.targetTemperatureDelta=+e[s++]),64&a&&(t.sensorState=this.sensorState=+e[s++]),0==this.sensorState){const e=128&a?0:1;1&a&&(t.temperature={flag:e,value:this.temperature/10}),2&a&&(t.humidity={flag:e,value:this.humidity/10})}return t}parseEvent(e,t){let a={},s=0;2==e[0].length?s+=1:e[0]=e[0].slice(2);const i=+e[s++];if(128&i&&(this.temperature=0,this.humidity=0,a.power=this.power=4&i?1:0,a.mode=this.mode=8&i?1:0,this.targetTemperature=0,this.targetTemperatureDelta=0,this.sensorState=0),1&i&&(this.temperature+=+e[s++]),2&i&&(this.humidity+=+e[s++]),4&i?this.power||(a.power=this.power=1):this.power&&(a.power=this.power=0),8&i?this.mode||(a.mode=this.mode=1):this.mode&&(a.mode=this.mode=0),16&i&&(a.targetTemperature=this.targetTemperature=+e[s++]),32&i&&(a.targetTemperatureDelta=this.targetTemperatureDelta=+e[s++]),64&i&&(a.sensorState=this.sensorState=+e[s++]),0==this.sensorState){const e=128&i?0:1;1&i&&(a.temperature={flag:e,value:this.temperature/10}),2&i&&(a.humidity={flag:e,value:this.humidity/10})}return[e.slice(s),a]}getLastData(){let e={};const t=0==this.sensorState?1:0;return e.temperature={flag:t,value:this.temperature/10},e.humidity={flag:t,value:this.humidity/10},e.power=this.power,e.mode=this.mode,e.targetTemperature=this.targetTemperature,e.targetTemperatureDelta=this.targetTemperatureDelta,e.sensorState=this.sensorState,e}createLogDataSet(e){return new c(e)}}class m{constructor(e,t,[a,s,i],r,n){this.id=e,this.ext="Z"+e,this.logLoader=t.logLoader,this.colors={t:a,h:s,p:i},this.isShowPower=!1,this.timeslots=[],this.begin=r,this.end=n}createEventParser(){return new u}getDataSet(e){return void 0===this.timeslots[e]&&(this.timeslots[e]=new c(e)),this.timeslots[e]}createDataSet(e){return void 0!==this.timeslots[e]?null:(this.timeslots[e]=new c(e),this.timeslots[e])}getParser(e){return{name:this.ext,parser:this.createEventParser(),dataset:this.getDataSet(e)}}load(e){e<this.begin||e>this.end||void 0!==this.timeslots[e]||this.logLoader.getLogByTimestamp(this.ext,e,(t=>{this.parseThermoLogData(t,e)}),(()=>{void 0===this.timeslots[e]&&(this.timeslots[e]=null)}))}getRegData(e,a,s){const r=m.DATASET_NAMES.map((()=>i.createzdata(e,a)));for(let i=t.getBeginDayTimestamp(e.begin);i<e.end;i+=86400)void 0===this.timeslots[i]?s(i):null!==this.timeslots[i]&&(this.timeslots[i].temperature.fillzdata(e,a,r[0]),this.timeslots[i].humidity.fillzdata(e,a,r[1]),this.timeslots[i].power.fillzdata(e,a,r[2]));return r}parseThermoLogData(e,t){const a=e.split("\n"),s=new l,i=new u,r=this.createDataSet(t);if(null===r)return;if(!e)return;a.forEach((e=>{const t=e.split(";");if(t.length<=2)return;const a=s.parseEventOld(t);if(0===a)return;const n=i.parseEventOld(t);r.push(n,a)}));const n=i.getLastData(),o=s.getLastTime();r.push(n,o)}}m.DATASET_NAMES=["Temperature","Humidity","Power"];class d{constructor(e,t,a){this.id=0,this.ext="L",this.load=e=>{e>=this.begin&&e<=this.end?this.logLoader.getLogByTimestamp(this.ext,e,(t=>{this.parseLogData(t,e)})):(this.thermoSensors.forEach((t=>t.load(e))),this.hydroSensors.forEach((t=>t.load(e))))},this.logLoader=e.logLoader,this.timeslots=[],this.begin=t,this.end=a,this.thermoSensors=e.thermoSensors,this.hydroSensors=e.hydroSensors}createEventParser(){return new l}getDataSet(e){return void 0===this.timeslots[e]&&(this.timeslots[e]=new o(e)),this.timeslots[e]}createDataSet(e){return void 0!==this.timeslots[e]?null:(this.timeslots[e]=new o(e),this.timeslots[e])}getParser(e){return{name:this.ext,parser:this.createEventParser(),dataset:this.getDataSet(e)}}parseLogData(e,t){const a=this.thermoSensors.map((e=>e.getParser(t))),s=this.hydroSensors.map((e=>e.getParser(t))),i={name:"T",parser:new l};if(!e)return;const r=e.split("\n");let n=!1;r.forEach((e=>{if(e.startsWith("F")){n=!0;const e=i.parser.getLastTime();if(0==e)return;return a.forEach((t=>t.dataset.push(t.parser.getLastData(),e))),void s.forEach((t=>t.dataset.push(t.parser.getLastData(),e)))}let t=e.split(";");const r=t.findIndex((e=>e.startsWith("T")));if(r<0)return;const[o,l]=i.parser.parseEvent(t.slice(r),n);for(t=t.slice(0,r);t.length>0;){const e=t[0],i=a.find((t=>e.startsWith(t.name)));if(void 0!==i){const[e,a]=i.parser.parseEvent(t,n);i.dataset.push(a,l.time),t=e;continue}const r=s.find((t=>e.startsWith(t.name)));if(void 0===r)t=t.slice(1);else{const[e,a]=r.parser.parseEvent(t,n);r.dataset.push(a,l.time),t=e}}n=!1}));const o=i.parser.getLastTime();a.forEach((e=>e.dataset.push(e.parser.getLastData(),o))),s.forEach((e=>e.dataset.push(e.parser.getLastData(),o)))}}function g({firmware:e="",controllerDateTime:t=""}){const[a,s]=React.useState(Date.now());React.useEffect((()=>{const e=setInterval((()=>{s(Date.now())}),1e3);return()=>{clearInterval(e)}}),[]);const i=new Date(a),r=i.toLocaleTimeString(),n=i.toLocaleDateString();return React.createElement("div",{className:"header_c8adb03"},React.createElement("div",{className:"left_cdef396"},React.createElement("div",{className:"title_f84cf26"},"Arduino TermoController"),React.createElement("div",null,e),React.createElement("div",null,t)),React.createElement("div",{className:"datetime_fdfbec6"},React.createElement("div",{className:"time_b1c1c45"},r),React.createElement("div",{className:"date_d7127cf"},n)))}function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},p.apply(this,arguments)}function f({active:e=!1,disabled:t=!1,children:a="Button",...s}){return React.createElement("div",p({className:"button_c0afaa2 "+(e?"active_b40adfc":"")},s),a)}function v({title:e="Modal title",isOpen:t=!1,onSubmit:a=(()=>{}),onCancel:s=(()=>{}),children:i=null}){return t&&React.createElement("div",{className:"modalOverlay_faa7164",onClick:s},React.createElement("div",{className:"modalWindow_fac41c2",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"modalHeader_ec3e5fe"},React.createElement("div",{className:"modalTitle_e276bb7"},e)),React.createElement("div",{className:"modalBody_a8134eb"},i),React.createElement("div",{className:"modalFooter_dcf803f"},React.createElement("span",{className:"cancel_b0d96c0",onClick:s},"Cancel"),React.createElement("span",{className:"apply_dc7f5d7",onClick:a},"Apply"))))}const w="name_fc64aab",y="value_be14f95",D="modal_button_aad8592",T=e=>Math.round(10*e)/10;function b({parameterName:e,displayedValue:t=0,controlledValue:a=0,controlledValue2:s=0,disabled:i=!1,update:r=(e=>{})}){const[n,o]=React.useState(!1),[l,h]=React.useState(a),[c,u]=React.useState(a),[m,d]=React.useState(!1);return i||React.useEffect((()=>{console.log("Effect update controlledValue",a),"number"==typeof a?(u(a),h(a)):h(c),d(!0)}),[a]),i?React.createElement("span",{className:"disabled_acbb102"},React.createElement("div",{className:w},e),React.createElement("div",{className:y},t)):React.createElement("span",{className:"enabled_fe9b8d8",onClick:()=>{o(!n)}},React.createElement("div",{className:w},e),React.createElement("div",null,React.createElement("span",{className:y},t),React.createElement("span",{className:m?y:"not_synced_value_afc6328"},"(",(m?c:l).toFixed(1),"±",s.toFixed(1),")")),React.createElement(v,{isOpen:n,title:"Set target temperature for Zone",onSubmit:()=>{l!=a&&(r(l),d(!1)),o(!1)},onCancel:()=>{h(a),o(!1)}},React.createElement("span",{className:D,onClick:()=>{h((e=>T(e-.1)))}},"-"),React.createElement("span",{className:"modal_parameter_be59a01",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:e=>{console.log(+e.target.innerText),h(T(+e.target.innerText))}},l.toFixed(1)),React.createElement("span",{className:D,onClick:()=>{h((e=>T(e+.1)))}},"+")))}const E={controlbox:"controlbox_d0c639d",header:"header_b26ca6e"};function R({zone:t,onSetTemperature:a,onSetPowerControl:s}){return React.createElement("div",{className:E.controlbox},React.createElement("div",{className:E.header},React.createElement("div",{className:E.indicator}),"ZONE"+t.id+" Sensor: "+e.sensorState(t.sensorState)),React.createElement("div",null,React.createElement(f,{active:!!t.onControl,onClick:()=>s(t)},"PWRCTRL"),React.createElement(f,{active:!!t.powerOn,disabled:!0},"PWR"),React.createElement(f,{onClick:()=>{console.log("showpwr_button")}},"SHOWPWR"),React.createElement(f,null,"CONFIG")),React.createElement("div",null,React.createElement(b,{parameterName:"temperature",displayedValue:t.temperature.toFixed(1)+"°",controlledValue:t.targetTemperature,controlledValue2:t.targetTemperatureDelta,update:e=>a({...t,targetTemperature:e})}),React.createElement(b,{parameterName:"humidity",displayedValue:t.humidity.toFixed(1)+"%",disabled:!0})),React.createElement("div",{className:"sensorstatus"}))}function M(e,t,a=window,s={}){const i=React.useRef(t).current;React.useEffect((()=>{if(!a?.addEventListener)return;console.log("AddEventListener",e);const t=e=>i(e);return a.addEventListener(e,t,s),()=>{console.log("RemoveEventListener",e),a.removeEventListener(e,t,s)}}),[e,a])}const S={gridBox:"gridBox_fc13aaa",context:"context_f11840f",detail:"detail_ec20b03",contextTickLabels:"contextTickLabels_fe07fb7",detailTickLabels:"detailTickLabels_f68035d",svgBox:"svgBox_b08058f",yLabels:"yLabels_e4cb634",yTickLabels:"yTickLabels_c40706f"};function L({data:e,height:t,barw:a=2,min:s,max:i,color:r="#FFF"}){let n=t/(i-s),o="";e[0].flag&&(o+="M0 "+(t-n*(e[0].value-s)));for(let i=1;i<e.length;i++)if(e[i].flag){let r=t-n*(e[i].value-s);e[i-1].flag?o+="L"+i*a+" "+r:o+="M"+i*a+" "+r}return React.createElement("path",{d:o,fill:"none",stroke:r,strokeWidth:"1"})}const C=[{value:1,unit:"s",shift:10800},{value:2,unit:"s",shift:10800},{value:5,unit:"s",shift:10800},{value:10,unit:"s",shift:10800},{value:20,unit:"s",shift:10800},{value:30,unit:"s",shift:10800},{value:60,unit:"m",shift:10800},{value:120,unit:"m",shift:10800},{value:300,unit:"m",shift:10800},{value:600,unit:"m",shift:10800},{value:1200,unit:"m",shift:10800},{value:1800,unit:"m",shift:10800},{value:3600,unit:"h",shift:10800},{value:7200,unit:"h",shift:10800},{value:10800,unit:"h",shift:10800},{value:21600,unit:"h",shift:10800},{value:43200,unit:"h",shift:10800},{value:86400,unit:"d",shift:10800},{value:172800,unit:"d",shift:10800},{value:345600,unit:"d",shift:10800},{value:604800,unit:"w",shift:27e4},{value:1209600,unit:"w",shift:27e4},{value:2629800,unit:"M",shift:1},{value:5259600,unit:"M",shift:2},{value:7889400,unit:"M",shift:3},{value:15778800,unit:"M",shift:6}],N=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];function x({title:e="TimeDiagram",width:t=300,height:a=200,min:s=0,max:i=1,children:r=null,timeInterval:n,onShift:o=(()=>{}),onZoom:l=(()=>{}),onSelectDate:h=(e=>{})}){const[c,u]=React.useState({x:0,y:0}),m=React.useRef(null);!function(e,t,a=(()=>{}),s=(()=>{}),i=(()=>{})){const r=React.useRef({isDragging:!1,clientX0:0,clientX1:0,pointerId1:null}).current,n=function(e,t=200){let a,s,i=!1;return function r(){if(i)return a=arguments,void(s=this);e.apply(this,arguments),i=!0,setTimeout((()=>{i=!1,a&&(r.apply(s,a),a=s=null)}),t)}}((e=>{if(e.preventDefault(),r.isDragging){if(e.isPrimary){let s=(e.offsetX-r.clientX0)/t;return r.clientX0=e.offsetX,a(s),void i(e.offsetX,e.offsetY)}if(r.pointerId1===e.pointerId){let a=e.offsetX-r.clientX0;if(Math.abs(a)<10)return;if(a=(r.clientX1-r.clientX0)/a,a<0)return;let i=r.clientX0/t;r.clientX1=e.offsetX,s(a,i)}}else i(e.offsetX,e.offsetY)}),30);M("wheel",(function(e){e.preventDefault();let a=e.wheelDelta>0?.9:1.1111111111111112,i=e.offsetX/t;s(a,i)}),e),M("pointerdown",(function(e){if(e.preventDefault(),e.isPrimary)return r.isDragging=!0,void(r.clientX0=e.offsetX);null===r.pointerId1&&(r.pointerId1=e.pointerId,r.clientX1=e.offsetX)}),e),M("pointermove",n,e),M("pointerup",(function(e){e.preventDefault(),e.isPrimary?r.isDragging=!1:r.pointerId1===e.pointerId&&(r.pointerId1=null,r.clientX1=0)}),e),M("pointerout",(function(e){i(0,0)}),e)}(m.current,t,o,l,((e,t)=>{u({x:e,y:t})}));let d=(i-s)/a;return React.createElement(React.Fragment,null,React.createElement("div",{className:S.header,style:{width:t}},React.createElement("div",null,e)),React.createElement("div",{className:S.gridBox},React.createElement("div",{className:S.context}," ",function(e,t,a,s=50){let i=s*(t-e)/a,[r]=[0,...C.filter((e=>i>=e.value)).keys()].slice(-1),n=a/(t-e);const o=[];let l=new Date(1e3*(e+10800)),h=e;if("M"==C[r].unit){do{let e=l.getUTCFullYear();l.setUTCHours(0),l.setMinutes(0),l.setSeconds(0),l.setUTCFullYear(e+1,0,1);let a=l.getTime()/1e3-10800,s=a<t?(a-h)*n:(t-h)*n;o.push({tick:h,label:e,width:s}),h=a}while(h<t);return o}if("d"==C[r].unit||"w"==C[r].unit){do{let e=l.getUTCMonth()+1,a=l.getUTCFullYear();l.setUTCHours(0),l.setMinutes(0),l.setSeconds(0),l.setUTCDate(1),l.setUTCMonth(e);let s=l.getTime()/1e3-10800,i=s<t?(s-h)*n:(t-h)*n;o.push({tick:h,label:a+"."+(e<10?"0":"")+e,width:i}),h=s}while(h<t);return o}if("h"==C[r].unit){let a=86400*~~((e+C[r].shift)/86400+1)-C[r].shift;do{let e=a<t?(a-h)*n:(t-h)*n,s=new Date(1e3*(h+10800)),i=s.getUTCDate(),r=s.getUTCMonth()+1,l=s.getUTCFullYear();o.push({tick:h,label:l+"."+(r<10?"0":"")+r+"."+(i<10?"0":"")+i,width:e}),h=a,a+=86400}while(h<t);return o}if("m"==C[r].unit){let a=3600*~~((e+C[r].shift)/3600+1)-C[r].shift;do{let e=a<t?(a-h)*n:(t-h)*n,s=new Date(1e3*(h+10800)),i=s.getUTCHours(),r=s.getUTCDate(),l=s.getUTCMonth()+1;o.push({tick:h,label:(l<10?"0":"")+l+"."+(r<10?"0":"")+r+" "+(i<10?"0":"")+i+"h",width:e}),h=a,a+=3600}while(h<t);return o}if("s"==C[r].unit){let a=60*~~((e+C[r].shift)/60+1)-C[r].shift;do{let e=a<t?(a-h)*n:(t-h)*n,s=new Date(1e3*(h+10800)),i=s.getUTCMinutes(),r=s.getUTCHours();o.push({tick:h,label:(r<10?"0":"")+r+":"+(i<10?"0":"")+i,width:e}),h=a,a+=60}while(h<t);return o}return o}(n.begin,n.end,t,50).map((e=>React.createElement("div",{className:S.contextTickLabels,key:e.tick,style:{width:e.width}},e.label)))),React.createElement("div",{className:S.detail,style:{height:a+12}}," ",function(e,t,a,s=50){let i=s*(t-e)/a,[r]=[0,...C.filter((e=>i>=e.value)).keys()].slice(-1),n=a/(t-e),o=e,l=new Date(1e3*(e+10800));const h=[];if("M"==C[r].unit){do{let e=l.getUTCMonth();l.getUTCFullYear(),l.setUTCHours(0),l.setMinutes(0),l.setSeconds(0),l.setUTCDate(1),l.setUTCMonth(e+(C[r].shift-e%C[r].shift));let a=l.getTime()/1e3-10800,s=a<t?(a-o)*n:(t-o)*n;h.push({tick:o,label:N[e],width:s}),o=a}while(o<t);return h}let c=C[r].value,u=~~((e+C[r].shift)/c+1)*c-C[r].shift;if("s"==C[r].unit){do{let e=u<t?(u-o)*n:(t-o)*n;l=new Date(1e3*(o+10800));let a=l.getUTCSeconds();h.push({tick:o,label:(a<10?"0":"")+a+"''",width:e}),o=u,u+=c}while(o<t);return h}if("m"==C[r].unit){do{let e=u<t?(u-o)*n:(t-o)*n;l=new Date(1e3*(o+10800));let a=l.getUTCMinutes();h.push({tick:o,label:(a<10?"0":"")+a+"'",width:e}),o=u,u+=c}while(o<t);return h}if("h"==C[r].unit){do{let e=u<t?(u-o)*n:(t-o)*n;l=new Date(1e3*(o+10800));let a=l.getUTCHours();h.push({tick:o,label:(a<10?"0":"")+a+"h",width:e}),o=u,u+=c}while(o<t);return h}if("d"==C[r].unit){do{let e=u<t?(u-o)*n:(t-o)*n;l=new Date(1e3*(o+10800));let a=l.getUTCDate();h.push({tick:o,label:(a<10?"0":"")+a,width:e}),o=u,u+=c}while(o<t);return h}if("w"==C[r].unit){do{let e=u<t?(u-o)*n:(t-o)*n;l=new Date(1e3*(o+10800));let a=l.getUTCDate();h.push({tick:o,label:(a<10?"0":"")+a,width:e}),o=u,u+=c}while(o<t);return h}return h}(n.begin,n.end,t,50).map((e=>React.createElement("div",{className:S.detailTickLabels,key:e.tick,style:{width:e.width,height:a+12},onClick:()=>{h(e.tick)}},e.label)))),React.createElement("div",{className:S.yLabels,style:{width:t,height:a}}," ",function(e,t,a,s=20){let i=s*(t-e)/a,r=Math.round(Math.log(i)/Math.log(10)),n=Math.pow(10,r),o=i/n;o<=1?o=1:o<=2?o=2:o<=5?o=5:(o=10,r++),r=r<0?-r:0;let l=n*o,h=a/(t-e),c=[],u=t,m=l*Math.floor(t/l);do{let t=m>e?h*(u-m):h*(u-e);t>0&&c.push({tick:u,label:u.toFixed(r),height:t}),u=m,m-=l}while(u>e);return c}(s,i,a).map(((e,t)=>React.createElement("div",{className:S.yTickLabels,key:t,style:{height:e.height}},e.label)))),React.createElement("svg",{ref:m,width:t,height:a,viewBox:`0 0 ${t} ${a}`,className:S.svgBox},r)),React.createElement("div",{style:{width:t}},new Date(1e3*(n.begin+c.x*(n.end-n.begin)/t)).toLocaleString()+" "+(i-d*c.y).toFixed(2)))}const k="row_f8cec4a",Y={width:35},_={width:60},z={width:30};function U({title:e="Table",headerName:t="value",data:a=[],time:s,height:i=200}){const[r,n]=React.useState(a.findIndex((e=>e.time>=s))),o=React.useRef(null),l=React.useRef(s);if(l.current!=s){l.current=s;let e=a.findIndex((e=>e.time>=s));console.log(e,r),n(e),console.log(l.current)}let h=~~(i/12),c=a.length,u=i*(h/c);u=u<5?5:u;let m=r/c*(i-u);const d=React.useRef({isDragging:!1,y:0,row:r});return M("wheel",(function(e){e.preventDefault();let t=e.wheelDelta>0?-5:5;n((e=>e+t))}),o.current),M("mousemove",(function(e){if(d.current.isDragging){let t=c*(e.clientY-d.current.y)/i,a=d.current.row+t;a<0&&(a=0),a>c-h&&(a=c-h),n(~~a)}}),o.current),M("mouseup",(function(e){d.current={isDragging:!1,y:0}}),o.current),React.createElement(React.Fragment,null,React.createElement("div",null,e),React.createElement("div",{ref:o,className:"wrapper_b8d6404",style:{height:i}},React.createElement("div",{className:"table_a2395b7"},React.createElement("div",{className:k},React.createElement("span",{style:Y},"#"),React.createElement("span",{style:_},"time"),React.createElement("span",{style:z},t))," ",a.slice(r,r+h).map(((e,t)=>{let a=(e.time+10800)%86400,s=~~(a/3600),i=~~(a%3600/60),n=a%60;return React.createElement("div",{className:k,key:t},React.createElement("span",{style:Y},r+t+1),React.createElement("span",{style:_},(s<10?"0":"")+s+":"+(i<10?"0":"")+i+":"+(n<10?"0":"")+n),React.createElement("span",{style:z},e.value))}))),React.createElement("div",{className:"scrollbarTrack_e15be30",onClick:function(e){n((e=>e+h>c?c:e+h))}},React.createElement("div",{className:"scrollbarUp_a9a56e8",style:{height:m},onClick:function(e){e.stopPropagation(),n((e=>e-h<0?0:e-h))}}),React.createElement("div",{className:"scrollbarThumb_dbe7646",style:{height:u},onMouseDown:function(e){e.preventDefault(),d.current={isDragging:!0,y:e.clientY,row:r},console.log("mouseDown",e)},onClick:e=>{e.stopPropagation()}}))))}const H=350,I=250;function O(e){const[t,a]=React.useState(e.timeInterval),[s,i]=React.useState({thermalData:[],hydroData:[]}),[r,n]=React.useState(0),o=React.useRef(e.logController).current;React.useEffect((()=>{a((t=>({begin:e.timeInterval.end-t.end+t.begin,end:e.timeInterval.end})))}),[e.timeInterval.end]),React.useEffect((()=>{o.setOnLoad((()=>a((e=>({...e}))))),o.addThermalSensor(2,["white","white","red"],new Date("2016.04.29")/1e3,new Date("2022.11.06")/1e3),o.addThermalSensor(3,["white","white","red"],new Date("2018.09.14")/1e3,new Date("2022.11.06")/1e3),o.addHydroSensor(0,["white","white","red"],new Date("2021.07.25")/1e3,new Date("2022.11.06")/1e3)}),[]),React.useEffect((()=>{let e=1*(t.end-t.begin)/H;const a=o.getThermalSensorsRegData(t,e),s=o.getHydroSensorsRegData(t,e);i({thermalData:a,hydroData:s})}),[t]);const l=React.useCallback((e=>{a((t=>{let a=t.end-t.begin;return{begin:t.begin-a*e,end:t.end-a*e}}))})),h=React.useCallback(((e,t)=>{a((a=>{let s=a.end-a.begin;if(e*s<300)return a;let i=a.begin+t*s;return{begin:i-e*(i-a.begin),end:i+e*(a.end-i)}}))})),c=React.useCallback((e=>{n(e)}));let u=Math.min(...s.thermalData.map((e=>e[0].min)))-1,m=Math.max(...s.thermalData.map((e=>e[0].max)))+1,d=Math.min(...s.thermalData.map((e=>e[1].min)))-1,g=Math.max(...s.thermalData.map((e=>e[1].max)))+1,p=Math.min(...s.hydroData.map((e=>e.min)))-.05,f=Math.max(...s.hydroData.map((e=>e.max)))+.05,w=86400*~~((r+10800)/86400)-10800;return React.createElement("div",{className:"wrapper_d20fbe7"},React.createElement("div",{className:"diagramsColumn_ebe3634"},React.createElement(x,{title:"Temperature, °C",timeInterval:t,onShift:l,onZoom:h,onSelectDate:c,min:u,max:m,width:H,height:I},s.thermalData[0]&&React.createElement(L,{data:s.thermalData[0][0].zdata,height:I,min:u,max:m,barw:1,color:"#ffa23c"}),s.thermalData[1]&&React.createElement(L,{data:s.thermalData[1][0].zdata,height:I,min:u,max:m,barw:1,color:"#88a23c"})),React.createElement(x,{title:"Humidity, %",timeInterval:t,onShift:l,onZoom:h,onSelectDate:c,min:d,max:g,width:H,height:I},s.thermalData[0]&&React.createElement(L,{data:s.thermalData[0][1].zdata,height:I,min:d,max:g,barw:1,color:"#bbb"}),s.thermalData[1]&&React.createElement(L,{data:s.thermalData[1][1].zdata,height:I,min:d,max:g,barw:1,color:"#88bbbb"})),React.createElement(x,{title:"Pressure Hydro System, bar",timeInterval:t,onShift:l,onZoom:h,onSelectDate:c,min:p,max:f,width:H,height:I},s.hydroData[0]&&React.createElement(L,{data:s.hydroData[0].zdata,height:I,min:p,max:f,barw:1,color:"#ffa23c"}))),0!=r&&React.createElement(v,{isOpen:0!=r,title:"Set target temperature for Zone",onCancel:()=>{n(0)}},React.createElement(U,{title:new Date(1e3*r).toLocaleDateString()+" Z2 H",data:o.hydroSensors[0].timeslots[w]?o.hydroSensors[0].timeslots[w].data:[],time:r})))}const P=[{type:"Z",id:1,temperature:14.1,targetTemperature:23.5,targetTemperatureDelta:.2,humidity:54.3,onControl:0,powerOn:0,sensorState:-3},{type:"Z",id:2,temperature:15.2,targetTemperature:21.2,targetTemperatureDelta:.1,humidity:48.1,onControl:0,powerOn:0,sensorState:-3},{type:"Z",id:3,temperature:5.9,targetTemperature:0,targetTemperatureDelta:0,humidity:85.1,onControl:0,powerOn:0,sensorState:-3},{type:"H",id:0,pressure:2.4}],B=window.location.hostname;console.log(B);const A="192.168.2.2"==B||"localhost"==B?"http://192.168.1.1:4480/data/log/":"./log/",X="192.168.2.2"==B?1:8,F=new e("http://192.168.2.2"),W=new class{constructor(e,t=(()=>{}),s=8){this.logLoader=new a(e,s),this.thermoSensors=[],this.hydroSensors=[],this.logLoader.onload=t,this.logController=new d(this,+new Date("2022.11.06")/1e3,Date.now()/1e3)}setOnLoad(e){this.logLoader.onload=e}addThermalSensor(e,[t,a,s],i,r){this.thermoSensors.push(new m(e,this,[t,a,s],i,r))}addHydroSensor(e,t,a,s){this.hydroSensors.push(new h(e,this,t,a,s))}getThermalSensorsRegData(e,t){return this.thermoSensors.map((a=>a.getRegData(e,t,this.logController.load)))}getHydroSensorsRegData(e,t){return this.hydroSensors.map((a=>a.getRegData(e,t,this.logController.load)))}}(A,(()=>{}),X),Z="192.168.2.2"==B||"localhost"==B||"192.168.1.1"==B||"10.8.0.1"==B?Date.now()/1e3:new Date("2022.06.26 00:00:00")/1e3,V="192.168.2.2"==B||"localhost"==B||"192.168.1.1"==B||"10.8.0.1"==B;function j(){const[t,a]=React.useState({version:"offline",unixtime:0,zones:P}),[s,i]=React.useState({begin:Z-172800,end:Z});React.useEffect((()=>{if(V){const t=setInterval((()=>{i((e=>({...e,end:Date.now()/1e3})))}),12e5),s=setInterval((()=>{F.getInfo((t=>a(e.parseInfo(t))),(()=>a((e=>({...e,version:"offline"})))))}),1e4);return()=>{clearInterval(s),t&&clearInterval(t)}}}),[]);const r=React.useCallback((e=>{F.setTemperature(e.id,e.targetTemperature,(()=>a((t=>({...t,zones:t.zones.map((t=>t.id==e.id?e:t))})))),(()=>a((t=>({...t,zones:t.zones.map((t=>t.id==e.id?{...t,targetTemperature:{}}:t))})))))})),n=React.useCallback((e=>{0!=e.onControl?F.powerOff(e.id,(()=>a((t=>({...t,zones:t.zones.map((t=>t.id==e.id?{...t,onControl:!t.onControl}:t))}))))):F.powerOn(e.id,(()=>a((t=>({...t,zones:t.zones.map((t=>t.id==e.id?{...t,onControl:!t.onControl}:t))})))))}));return React.createElement("div",{className:"wrapper_d808929"},React.createElement(g,{firmware:t.version,controllerDateTime:new Date(1e3*t.unixtime).toLocaleTimeString()}),React.createElement("div",{className:"main_ef0bc9e"},React.createElement("div",{className:"controlsbox_d8af8a5"},t.zones.filter((e=>"Z"===e.type)).map(((e,t)=>React.createElement(R,{key:t,zone:e,onSetTemperature:r,onSetPowerControl:n})))),React.createElement("div",{className:"diagramsbox_e0be825"},React.createElement(O,{timeInterval:s,logController:W})),React.createElement("div",{className:"info_bae79b0"},JSON.stringify(t))))}ReactDOM.render(React.createElement(j,null),document.getElementById("root"))})();