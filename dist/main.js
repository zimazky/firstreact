(()=>{"use strict";function e({firmware:e="",controllerDateTime:t=""}){const[a,i]=React.useState(Date.now());React.useEffect((()=>{const e=setInterval((()=>{i(Date.now())}),1e3);return()=>{clearInterval(e)}}),[]);const l=new Date(a),n=l.toLocaleTimeString(),r=l.toLocaleDateString();return React.createElement("div",{className:"header_c8adb03"},React.createElement("div",{className:"left_cdef396"},React.createElement("div",{className:"title_f84cf26"},"Arduino TermoController"),React.createElement("div",null,e),React.createElement("div",null,t)),React.createElement("div",{className:"datetime_fdfbec6"},React.createElement("div",{className:"time_b1c1c45"},n),React.createElement("div",{className:"date_d7127cf"},r)))}class t{constructor(e){this.url=e}getInfo(e=(e=>{}),t=(e=>{})){return fetch(this.url+"/?g:i&r="+Math.random()).then((e=>e.text())).then((t=>e(t))).catch((e=>{console.log("ArduinoController not available"),t(e)}))}setTemperature(e,t,a=(()=>{}),i=(()=>{})){return fetch(this.url+"/?s"+e+"t:"+Math.round(10*t)+"&r="+Math.random()).then((()=>{console.log("ArduinoController set temperature"),a()})).catch((()=>{console.log("ArduinoController set temperature failure"),i()}))}powerOn(e,t=(()=>{}),a=(()=>{})){return fetch(this.url+"/?s"+e+"m:1&r="+Math.random()).then((()=>{console.log("Power On",e),t()})).catch((()=>{console.log("Power On failure"),a()}))}powerOff(e,t=(()=>{}),a=(()=>{})){return fetch(this.url+"/?s"+e+"m:0&r="+Math.random()).then((()=>{console.log("Power Off",e),t()})).catch((()=>{console.log("Power Off failure"),a()}))}static parseInfo(e){const t=e.split(";"),[a,i,l,n,r,s,o,c,...u]=t;return{version:"ver."+a,numofz:+i,unixtime:+l,starttime:+n,lastsynctime:+r,lastsyncdelta:+s,lastsyncinterval:+o,tickcounter:+c,zones:function e(t,a=[],i=0){if(!t.length)return a;const[l,n,r,s,o,c,u,...h]=t;return a.push({id:++i,temperature:l/10,targetTemperature:n/10,humidity:r/10,onControl:+s,powerOn:+o,targetTemperatureDelta:c/10,sensorState:+u}),e(h,a,i)}(u)}}static states=["OK","ErrChecksum","ErrTimeout","ErrConnect","ErrAckL","ErrAckH","ErrUnknown"];static sensorState=e=>t.states[-e]}function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},a.apply(this,arguments)}function i({active:e=!1,disabled:t=!1,children:i="Button",...l}){return React.createElement("div",a({className:"button_c0afaa2 "+(e?"active_b40adfc":"")},l),i)}function l({title:e="Modal title",isOpen:t=!1,onSubmit:a=(()=>{}),onCancel:i=(()=>{}),children:l=null}){return t&&React.createElement("div",{className:"modalOverlay_faa7164",onClick:i},React.createElement("div",{className:"modalWindow_fac41c2",onClick:e=>e.stopPropagation()},React.createElement("div",{className:"modalHeader_ec3e5fe"},React.createElement("div",{className:"modalTitle_e276bb7"},e)),React.createElement("div",{className:"modalBody_a8134eb"},l),React.createElement("div",{className:"modalFooter_dcf803f"},React.createElement("span",{className:"cancel_b0d96c0",onClick:i},"Cancel"),React.createElement("span",{className:"apply_dc7f5d7",onClick:a},"Apply"))))}const n="name_fc64aab",r="value_be14f95",s="modal_button_aad8592",o=e=>Math.round(10*e)/10;function c({parameterName:e,displayedValue:t=0,controlledValue:a=0,controlledValue2:i=0,disabled:c=!1,update:u=(e=>{})}){const[h,m]=React.useState(!1),[d,f]=React.useState(a),[g,p]=React.useState(a),[v,w]=React.useState(!1);return c||React.useEffect((()=>{console.log("Effect update controlledValue",a),"number"==typeof a?(p(a),f(a)):f(g),w(!0)}),[a]),c?React.createElement("span",{className:"disabled_acbb102"},React.createElement("div",{className:n},e),React.createElement("div",{className:r},t)):React.createElement("span",{className:"enabled_fe9b8d8",onClick:()=>{m(!h)}},React.createElement("div",{className:n},e),React.createElement("div",null,React.createElement("span",{className:r},t),React.createElement("span",{className:v?r:"not_synced_value_afc6328"},"(",(v?g:d).toFixed(1),"±",i.toFixed(1),")")),React.createElement(l,{isOpen:h,title:"Set target temperature for Zone",onSubmit:()=>{d!=a&&(u(d),w(!1)),m(!1)},onCancel:()=>{f(a),m(!1)}},React.createElement("span",{className:s,onClick:()=>{f((e=>o(e-.1)))}},"-"),React.createElement("span",{className:"modal_parameter_be59a01",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:e=>{console.log(+e.target.innerText),f(o(+e.target.innerText))}},d.toFixed(1)),React.createElement("span",{className:s,onClick:()=>{f((e=>o(e+.1)))}},"+")))}const u={controlbox:"controlbox_d0c639d",header:"header_b26ca6e"};function h({zone:e,onSetTemperature:a,onSetPowerControl:l}){return React.createElement("div",{className:u.controlbox},React.createElement("div",{className:u.header},React.createElement("div",{className:u.indicator}),"ZONE"+e.id+" Sensor: "+t.sensorState(e.sensorState)),React.createElement("div",null,React.createElement(i,{active:!!e.onControl,onClick:()=>l(e.id)},"PWRCTRL"),React.createElement(i,{active:!!e.powerOn,disabled:!0},"PWR"),React.createElement(i,{onClick:()=>{console.log("showpwr_button")}},"SHOWPWR"),React.createElement(i,null,"CONFIG")),React.createElement("div",null,React.createElement(c,{parameterName:"temperature",displayedValue:e.temperature.toFixed(1)+"°",controlledValue:e.targetTemperature,controlledValue2:e.targetTemperatureDelta,update:t=>a({...e,targetTemperature:t})}),React.createElement(c,{parameterName:"humidity",displayedValue:e.humidity.toFixed(1)+"%",disabled:!0})),React.createElement("div",{className:"sensorstatus"}))}class m{constructor(e,t="stepped"){this.time=e,this.zmode=t,this.data=[],this.flag=0,this.value=0,this.high=Number.MIN_VALUE,this.low=Number.MAX_VALUE,this.open=0,this.close=0,this.topen=0,this.tclose=0,this.nclose=0,this.tstep=0,this.zdata=[]}push(e){if(!(e.time<this.time)){if(0==this.data.length)return this.flag=1,this.value=this.low=this.high=this.open=this.close=e.value,this.topen=this.tclose=e.time,void this.data.push({flag:0,time:e.time,value:e.value});this.tclose>this.topen&&(this.value=(this.value*(this.tclose-this.topen)+(this.close-this.open)*(e.time-this.tclose))/(e.time-this.topen)),this.close!=e.value||1!=e.flag?(this.low=Math.min(this.low,e.value),this.high=Math.max(this.high,e.value),this.close=e.value,this.tclose=e.time,this.nclose=0,this.data.push({flag:e.flag,time:e.time,value:e.value})):0==this.nclose?(this.nclose++,this.tclose=e.time,this.data.push({flag:e.flag,time:e.time,value:e.value})):(this.data[this.data.length-1].time=e.time,this.tclose=e.time)}}getlinearregdata(e){for(var t=[],a=this.data[0],i=this.time,l=a.value;i+e<a.time;)t.push({flag:0,value:l}),i+=e;t.push({flag:1,value:l});for(var n=1;n<this.data.length;n++){a=this.data[n];var r=t.length-1,s=this.data[n-1];if(a.time<i+e)t[r].value+=(a.value-l)*(i+e-a.time)/e,l=a.value;else{i+=e;var o=(a.value-s.value)/(a.time-s.time);for(l=s.value+o*(i-s.time);i+e<a.time;){var c=l+o*e;t.push({flag:a.flag,value:(l+c)/2}),l=c,i+=e}t.push({flag:1,value:l})}}return t}getsteppedregdata(e){for(var t=[],a=this.data[0],i=this.time,l=a.value;i+e<a.time;)t.push({flag:0,value:l}),i+=e;t.push({flag:1,value:l});for(var n=1;n<this.data.length;n++){a=this.data[n];var r=t.length-1,s=this.data[n-1];if(a.time<i+e)t[r].value+=(a.value-l)*(i+e-a.time)/e,l=a.value;else{for(i+=e,l=s.value;i+e<a.time;)t.push({flag:a.flag,value:l}),i+=e;0==a.flag&&(l=a.value),t.push({flag:1,value:l})}}return t.push({flag:1,value:l}),t}getohlcregdata(e){for(var t=[],a=this.data[0],i=this.time,l=a.value;i+e<a.time;)t.push({flag:0,open:l,high:l,low:l,close:l}),i+=e;t.push({flag:1,open:l,high:l,low:l,close:l});for(var n=1;n<this.data.length;n++){a=this.data[n];var r=t.length-1,s=this.data[n-1];if(a.time<i+e)t[r].close=a.value,t[r].high=a.value>t[r].high?a.value:t[r].high,t[r].low=a.value<t[r].low?a.value:t[r].low;else{for(i+=e,l=s.value;i+e<a.time;)t.push({flag:a.flag,open:l,high:l,low:l,close:l}),i+=e;0==a.flag&&(l=a.value),t.push({flag:1,open:l,high:l,low:l,close:l})}}return t.push({flag:1,open:l,high:l,low:l,close:l}),t}gethighlowregdata(e){for(var t=[],a=this.data[0],i=this.time,l=a.value;i+e<a.time;)t.push({flag:0,high:l,low:l}),i+=e;t.push({flag:1,high:l,low:l});for(var n=1;n<this.data.length;n++){a=this.data[n];var r=t.length-1,s=this.data[n-1];if(a.time<i+e)t[r].high=a.value>t[r].high?a.value:t[r].high,t[r].low=a.value<t[r].low?a.value:t[r].low;else{for(i+=e,l=s.value;i+e<a.time;)t.push({flag:a.flag,high:l,low:l}),i+=e;0==a.flag&&(l=a.value),t.push({flag:1,high:l,low:l})}}return t.push({flag:1,high:l,low:l}),t}rezoom(e){e<1&&(e=1),this.tstep!=e&&0!=this.data.length&&(this.tstep=e,"linear"==this.zmode?this.zdata=this.getlinearregdata(e):"stepped"==this.zmode?this.zdata=this.getsteppedregdata(e):"highlow"==this.zmode?this.zdata=this.gethighlowregdata(e):"ohlc"==this.zmode&&(this.zdata=this.getohlcregdata(e)))}fillzdata(e,t,a){if(this.tclose<=e.begin||this.topen>=e.end)return a;this.rezoom(t);var i=e.begin,l=~~((e.begin-this.time)/t),n=0;l<0&&(i=this.time,n=-l,l=0);var r=a.min,s=a.max;if("linear"==this.zmode||"stepped"==this.zmode)for(;i<e.end&&i<this.tclose;l++,n++,i+=t){var o=this.zdata[l].flag;a.zdata[n].flag=o;var c=this.zdata[l].value;a.zdata[n].value=c,1==o&&(r=c<r?c:r,s=c>s?c:s)}else if("highlow"==this.zmode)for(;i<e.end&&i<this.tclose;l++,n++,i+=t){o=this.zdata[l].flag,a.zdata[n].flag=o;var u=this.zdata[l].high,h=this.zdata[l].low;a.zdata[n].high=u,a.zdata[n].low=h,1==o&&(r=h<r?h:r,s=u>s?u:s)}else if("ohlc"==this.zmode)for(;i<e.end&&i<this.tclose;l++,n++,i+=t){o=this.zdata[l].flag,a.zdata[n].flag=o;var m=this.zdata[l].open,d=(u=this.zdata[l].high,h=this.zdata[l].low,this.zdata[l].close);a.zdata[n].open=m,a.zdata[n].high=u,a.zdata[n].low=h,a.zdata[n].close=d,1==o&&(r=h<r?h:r,s=u>s?u:s)}return{zdata:a.zdata,min:r,max:s}}integrate(e){var t=0;if(this.data.length>0)for(var a=this.data[0],i=1;i<this.data.length;i++){var l=this.data[i];l.time>e.begin&&l.time<=e.end&&(t+=a.value*(l.time-a.time),a=l)}return t}clearzdata(){this.zdata=[],this.tstep=0}}class d{static WEEKDAYS=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];static MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];constructor(e=3,t=1){this.timezone=e,this.startweek=t}getBegintWeekTimestamp(e){const t=new Date(1e3*e);t.setHours(0,0,0,0);const a=t.getDate();let i=t.getDay();return i=0==i?7:i,t.setDate(a-i+this.startweek)/1e3}getBeginDayTimestamp(e){return 86400*~~((e+3600*this.timezone)/86400)-3600*this.timezone}getYYYYMMDD(e){const t=new Date(1e3*(e+3600*this.timezone));var a=t.getUTCDate(),i=t.getUTCMonth()+1;return t.getUTCFullYear()+(i<10?"0":"")+i+(a<10?"0":"")+a}static getDayMonthWeekday(e){const t=new Date(1e3*e);return{day:t.getDate(),month:t.getMonth(),weekday:t.getDay()}}static getWeekday(e){return new Date(1e3*e).getDay()}static getTimeString(e){const t=new Date(1e3*e),a=t.getHours(),i=t.getMinutes();return(a>9?"":"0")+a+(i>9?":":":0")+i}}class f{static queue=[];constructor(e,t,a=8,i=3){this.datetime=new d(i),this.threads=a,this.url=e,this.ext=t,this.array=[],this.tryes=[],this.parse=function(e,t){return{time:e,status:0}},this.onload=function(){}}load(e){if(f.queue.length>=this.threads)return;if(void 0!==this.array[e])return;if(e>this.datetime.getBeginDayTimestamp(Date.now()/1e3))return;const t=this.datetime.getYYYYMMDD(e)+"."+this.ext;if(f.queue.includes(t))return;f.queue.push(t);const a=this.url+t;return console.log(a),fetch(a).then((e=>e.text())).then((t=>{this.array[e]=this.parse(e,t)})).catch((t=>{console.log("loading error",t),this.array[e]={flag:0}})).finally((()=>{f.queue=f.queue.filter((e=>e!=t)),this.onload()}))}preparezdata(e,t){for(var a=Number.MAX_VALUE,i=Number.MIN_VALUE,l=[],n=e.begin;n<e.end;n+=t)l.push({flag:0});return{zdata:l,min:a,max:i}}getzdata({begin:e,end:t},a){for(var i=this.preparezdata(timeinterval,a),l=this.datetime.getBeginDayTimestamp(e);l<t;l+=86400)void 0===this.array[l]?this.load(l,"text"):0!=this.array[l].flag&&(i=this.array[l].fillzdata(timeinterval,a,i));return i}}function g(e,t,a=window,i={}){const l=React.useRef(t).current;React.useEffect((()=>{if(!a?.addEventListener)return;console.log("AddEventListener",e);const t=e=>l(e);return a.addEventListener(e,t,i),()=>{console.log("RemoveEventListener",e),a.removeEventListener(e,t,i)}}),[e,a])}const p={gridBox:"gridBox_fc13aaa",context:"context_f11840f",detail:"detail_ec20b03",contextTickLabels:"contextTickLabels_fe07fb7",detailTickLabels:"detailTickLabels_f68035d",svgBox:"svgBox_b08058f",yLabels:"yLabels_e4cb634",yTickLabels:"yTickLabels_c40706f"};function v({data:e,height:t,barw:a=2,min:i,max:l,color:n="#FFF"}){let r=t/(l-i),s="";e[0].flag&&(s+="M0 "+(t-r*(e[0].value-i)));for(let l=1;l<e.length;l++)if(e[l].flag){let n=t-r*(e[l].value-i);e[l-1].flag?s+="L"+l*a+" "+n:s+="M"+l*a+" "+n}return React.createElement("path",{d:s,fill:"none",stroke:n,strokeWidth:"1"})}const w=[{value:1,unit:"s",shift:10800},{value:2,unit:"s",shift:10800},{value:5,unit:"s",shift:10800},{value:10,unit:"s",shift:10800},{value:20,unit:"s",shift:10800},{value:30,unit:"s",shift:10800},{value:60,unit:"m",shift:10800},{value:120,unit:"m",shift:10800},{value:300,unit:"m",shift:10800},{value:600,unit:"m",shift:10800},{value:1200,unit:"m",shift:10800},{value:1800,unit:"m",shift:10800},{value:3600,unit:"h",shift:10800},{value:7200,unit:"h",shift:10800},{value:10800,unit:"h",shift:10800},{value:21600,unit:"h",shift:10800},{value:43200,unit:"h",shift:10800},{value:86400,unit:"d",shift:10800},{value:172800,unit:"d",shift:10800},{value:345600,unit:"d",shift:10800},{value:604800,unit:"w",shift:27e4},{value:1209600,unit:"w",shift:27e4},{value:2629800,unit:"M",shift:1},{value:5259600,unit:"M",shift:2},{value:7889400,unit:"M",shift:3},{value:15778800,unit:"M",shift:6}],b=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];function R({title:e="TimeDiagram",width:t=300,height:a=200,min:i=0,max:l=1,children:n=null,timeInterval:r,onShift:s=(()=>{}),onZoom:o=(()=>{}),onSelectDate:c=(()=>{})}){const[u,h]=React.useState({x:0,y:0}),m=React.useRef(null);!function(e,t,a=(()=>{}),i=(()=>{}),l=(()=>{})){const n=React.useRef({isDragging:!1,clientX0:0,clientX1:0,pointerId1:null}).current,r=function(e,t=200){let a,i,l=!1;return function n(){if(l)return a=arguments,void(i=this);e.apply(this,arguments),l=!0,setTimeout((()=>{l=!1,a&&(n.apply(i,a),a=i=null)}),t)}}((e=>{if(e.preventDefault(),n.isDragging){if(e.isPrimary){let i=(e.offsetX-n.clientX0)/t;return n.clientX0=e.offsetX,a(i),void l(e.offsetX,e.offsetY)}if(n.pointerId1===e.pointerId){let a=e.offsetX-n.clientX0;if(Math.abs(a)<10)return;if(a=(n.clientX1-n.clientX0)/a,a<0)return;let l=n.clientX0/t;n.clientX1=e.offsetX,i(a,l)}}else l(e.offsetX,e.offsetY)}),30);g("wheel",(function(e){e.preventDefault();let a=e.wheelDelta>0?.9:1.1111111111111112,l=e.offsetX/t;i(a,l)}),e),g("pointerdown",(function(e){if(e.preventDefault(),e.isPrimary)return n.isDragging=!0,void(n.clientX0=e.offsetX);null===n.pointerId1&&(n.pointerId1=e.pointerId,n.clientX1=e.offsetX)}),e),g("pointermove",r,e),g("pointerup",(function(e){e.preventDefault(),e.isPrimary?n.isDragging=!1:n.pointerId1===e.pointerId&&(n.pointerId1=null,n.clientX1=0)}),e),g("pointerout",(function(e){l(0,0)}),e)}(m.current,t,s,o,((e,t)=>{h({x:e,y:t})}));let d=(l-i)/a;return React.createElement(React.Fragment,null,React.createElement("div",{className:p.header,style:{width:t}},React.createElement("div",null,e)),React.createElement("div",{className:p.gridBox},React.createElement("div",{className:p.context}," ",function(e,t,a,i=50){let l=i*(t-e)/a,[n]=[0,...w.filter((e=>l>=e.value)).keys()].slice(-1),r=a/(t-e);const s=[];let o=new Date(1e3*(e+10800)),c=e;if("M"==w[n].unit){do{let e=o.getUTCFullYear();o.setUTCHours(0),o.setMinutes(0),o.setSeconds(0),o.setUTCFullYear(e+1,0,1);let a=o.getTime()/1e3-10800,i=a<t?(a-c)*r:(t-c)*r;s.push({tick:c,label:e,width:i}),c=a}while(c<t);return s}if("d"==w[n].unit||"w"==w[n].unit){do{let e=o.getUTCMonth()+1,a=o.getUTCFullYear();o.setUTCHours(0),o.setMinutes(0),o.setSeconds(0),o.setUTCDate(1),o.setUTCMonth(e);let i=o.getTime()/1e3-10800,l=i<t?(i-c)*r:(t-c)*r;s.push({tick:c,label:a+"."+(e<10?"0":"")+e,width:l}),c=i}while(c<t);return s}if("h"==w[n].unit){let a=86400*~~((e+w[n].shift)/86400+1)-w[n].shift;do{let e=a<t?(a-c)*r:(t-c)*r,i=new Date(1e3*(c+10800)),l=i.getUTCDate(),n=i.getUTCMonth()+1,o=i.getUTCFullYear();s.push({tick:c,label:o+"."+(n<10?"0":"")+n+"."+(l<10?"0":"")+l,width:e}),c=a,a+=86400}while(c<t);return s}if("m"==w[n].unit){let a=3600*~~((e+w[n].shift)/3600+1)-w[n].shift;do{let e=a<t?(a-c)*r:(t-c)*r,i=new Date(1e3*(c+10800)),l=i.getUTCHours(),n=i.getUTCDate(),o=i.getUTCMonth()+1;s.push({tick:c,label:(o<10?"0":"")+o+"."+(n<10?"0":"")+n+" "+(l<10?"0":"")+l+"h",width:e}),c=a,a+=3600}while(c<t);return s}if("s"==w[n].unit){let a=60*~~((e+w[n].shift)/60+1)-w[n].shift;do{let e=a<t?(a-c)*r:(t-c)*r,i=new Date(1e3*(c+10800)),l=i.getUTCMinutes(),n=i.getUTCHours();s.push({tick:c,label:(n<10?"0":"")+n+":"+(l<10?"0":"")+l,width:e}),c=a,a+=60}while(c<t);return s}return s}(r.begin,r.end,t,50).map((e=>React.createElement("div",{className:p.contextTickLabels,key:e.tick,style:{width:e.width}},e.label)))),React.createElement("div",{className:p.detail,style:{height:a+12}}," ",function(e,t,a,i=50){let l=i*(t-e)/a,[n]=[0,...w.filter((e=>l>=e.value)).keys()].slice(-1),r=a/(t-e),s=e,o=new Date(1e3*(e+10800));const c=[];if("M"==w[n].unit){do{let e=o.getUTCMonth();o.getUTCFullYear(),o.setUTCHours(0),o.setMinutes(0),o.setSeconds(0),o.setUTCDate(1),o.setUTCMonth(e+(w[n].shift-e%w[n].shift));let a=o.getTime()/1e3-10800,i=a<t?(a-s)*r:(t-s)*r;c.push({tick:s,label:b[e],width:i}),s=a}while(s<t);return c}let u=w[n].value,h=~~((e+w[n].shift)/u+1)*u-w[n].shift;if("s"==w[n].unit){do{let e=h<t?(h-s)*r:(t-s)*r;o=new Date(1e3*(s+10800));let a=o.getUTCSeconds();c.push({tick:s,label:(a<10?"0":"")+a+"''",width:e}),s=h,h+=u}while(s<t);return c}if("m"==w[n].unit){do{let e=h<t?(h-s)*r:(t-s)*r;o=new Date(1e3*(s+10800));let a=o.getUTCMinutes();c.push({tick:s,label:(a<10?"0":"")+a+"'",width:e}),s=h,h+=u}while(s<t);return c}if("h"==w[n].unit){do{let e=h<t?(h-s)*r:(t-s)*r;o=new Date(1e3*(s+10800));let a=o.getUTCHours();c.push({tick:s,label:(a<10?"0":"")+a+"h",width:e}),s=h,h+=u}while(s<t);return c}if("d"==w[n].unit){do{let e=h<t?(h-s)*r:(t-s)*r;o=new Date(1e3*(s+10800));let a=o.getUTCDate();c.push({tick:s,label:(a<10?"0":"")+a,width:e}),s=h,h+=u}while(s<t);return c}if("w"==w[n].unit){do{let e=h<t?(h-s)*r:(t-s)*r;o=new Date(1e3*(s+10800));let a=o.getUTCDate();c.push({tick:s,label:(a<10?"0":"")+a,width:e}),s=h,h+=u}while(s<t);return c}return c}(r.begin,r.end,t,50).map((e=>React.createElement("div",{className:p.detailTickLabels,key:e.tick,style:{width:e.width,height:a+12},onClick:()=>{c(e.tick)}},e.label)))),React.createElement("div",{className:p.yLabels,style:{width:t,height:a}}," ",function(e,t,a,i=20){let l=i*(t-e)/a,n=Math.round(Math.log(l)/Math.log(10)),r=Math.pow(10,n),s=l/r;s<=1?s=1:s<=2?s=2:s<=5?s=5:(s=10,n++),n=n<0?-n:0;let o=r*s,c=a/(t-e),u=[],h=t,m=o*~~(t/o);do{let t=m>e?c*(h-m):c*(h-e);t>0&&u.push({tick:h,label:h.toFixed(n),height:t}),h=m,m-=o}while(h>e);return u}(i,l,a).map(((e,t)=>React.createElement("div",{className:p.yTickLabels,key:t,style:{height:e.height}},e.label)))),React.createElement("svg",{ref:m,width:t,height:a,viewBox:`0 0 ${t} ${a}`,className:p.svgBox},n)),React.createElement("div",{style:{width:t}},new Date(1e3*(r.begin+u.x*(r.end-r.begin)/t)).toLocaleString()+" "+(l-d*u.y).toFixed(2)))}const E="row_f8cec4a",y={width:35},z={width:60},T={width:30};function D({title:e="Table",headerName:t="value",data:a=[],time:i,height:l=200}){const[n,r]=React.useState(a.findIndex((e=>e.time>=i))),s=React.useRef(null),o=React.useRef(i);if(o.current!=i){o.current=i;let e=a.findIndex((e=>e.time>=i));console.log(e,n),r(e),console.log(o.current)}let c=~~(l/12),u=a.length,h=l*(c/u);h=h<5?5:h;let m=n/u*(l-h);const d=React.useRef({isDragging:!1,y:0,row:n});return g("wheel",(function(e){e.preventDefault();let t=e.wheelDelta>0?-5:5;r((e=>e+t))}),s.current),g("mousemove",(function(e){if(d.current.isDragging){let t=u*(e.clientY-d.current.y)/l,a=d.current.row+t;a<0&&(a=0),a>u-c&&(a=u-c),r(~~a)}}),s.current),g("mouseup",(function(e){d.current={isDragging:!1,y:0}}),s.current),React.createElement(React.Fragment,null,React.createElement("div",null,e),React.createElement("div",{ref:s,className:"wrapper_b8d6404",style:{height:l}},React.createElement("div",{className:"table_a2395b7"},React.createElement("div",{className:E},React.createElement("span",{style:y},"#"),React.createElement("span",{style:z},"time"),React.createElement("span",{style:T},t))," ",a.slice(n,n+c).map(((e,t)=>{let a=(e.time+10800)%86400,i=~~(a/3600),l=~~(a%3600/60),r=a%60;return React.createElement("div",{className:E,key:t},React.createElement("span",{style:y},n+t+1),React.createElement("span",{style:z},(i<10?"0":"")+i+":"+(l<10?"0":"")+l+":"+(r<10?"0":"")+r),React.createElement("span",{style:T},e.value))}))),React.createElement("div",{className:"scrollbarTrack_e15be30",onClick:function(e){r((e=>e+c>u?u:e+c))}},React.createElement("div",{className:"scrollbarUp_a9a56e8",style:{height:m},onClick:function(e){e.stopPropagation(),r((e=>e-c<0?0:e-c))}}),React.createElement("div",{className:"scrollbarThumb_dbe7646",style:{height:h},onMouseDown:function(e){e.preventDefault(),d.current={isDragging:!0,y:e.clientY,row:n},console.log("mouseDown",e)},onClick:e=>{e.stopPropagation()}}))))}class N extends f{constructor(e,t,a,i,l){super(e,"Z"+t),this.tcolor=a,this.hcolor=i,this.pcolor=l,this.showpower=!1,this.parse=function(e,t){return class{static parse=function(e,t){const a=new m(t),i=new m(t),l=new m(t);if(!e)return{t:a,h:i,p:l};const n=e.split("\n");let r=0,s=0,o=0,c=0,u=0,h=0,d=0,f=0;return n.forEach((e=>{const t=e.split(";");if(t.length<2)return;const n=t[0];if(128&n){s=0,o=0,c=0,u=0,d=0,r=+t[1];let e=2;1&n&&(s=+t[e++]),2&n&&(o=+t[e++]),h=4&n?1:0,l.push({flag:1,time:r,value:h}),16&n&&(c=+t[e++]),32&n&&(u=+t[e++]),64&n&&(d=+t[e++]),0==d&&(a.push({flag:0,time:r,value:s/10}),i.push({flag:0,time:r,value:o/10}))}else{if(0==r)return;let e=+t[1];e>2147483647&&(e-=4294967296),e<0&&console.log("correction time difference",e,r),r+=e;let m=2;1&n&&(s+=+t[m++]),2&n&&(o+=+t[m++]),4&n?h||l.push({flag:1,time:r,value:h=1}):h&&l.push({flag:1,time:r,value:h=0}),16&n&&(c+=+t[m++]),32&n&&(u+=+t[m++]),64&n&&(d=+t[m++]),f=0==d?1:0,0==d&&(1&n&&a.push({flag:f,time:r,value:s/10}),2&n&&i.push({flag:f,time:r,value:o/10}))}})),0!=a.data.length&&a.push({flag:f,time:r,value:s/10}),0!=i.data.length&&i.push({flag:f,time:r,value:o/10}),0!=l.data.length&&l.push({flag:1,time:r,value:h}),{t:a,h:i,p:l}}}.parse(t,e)}}preparezdata(e,t){for(var a={zdata:[],min:Number.MAX_VALUE,max:Number.MIN_VALUE},i={zdata:[],min:Number.MAX_VALUE,max:Number.MIN_VALUE},l={zdata:[],min:Number.MAX_VALUE,max:Number.MIN_VALUE},n=e.begin;n<e.end;n+=t)a.zdata.push({flag:0}),i.zdata.push({flag:0}),l.zdata.push({flag:0});return{t:a,h:i,p:l}}getzdata(e,t){for(var a=this.preparezdata(e,t),i=86400*~~((e.begin+10800)/86400)-10800;i<e.end;i+=86400)void 0===this.array[i]?this.load(i,"text"):0!=this.array[i].flag&&(a.t=this.array[i].t.fillzdata(e,t,a.t),a.h=this.array[i].h.fillzdata(e,t,a.h),a.p=this.array[i].p.fillzdata(e,t,a.p));return a}}let C=[];const k=250;function x(e){const[t,a]=React.useState(e.timeInterval),[i,n]=React.useState([]),[r,s]=React.useState(0);React.useEffect((()=>{a((t=>({begin:e.timeInterval.end-t.end+t.begin,end:e.timeInterval.end})))}),[e.timeInterval.end]),React.useEffect((()=>{C.push(new N("./log/",2,"white","white","red")),C.push(new N("./log/",3,"white","white","red")),C.forEach((e=>{e.onload=()=>a((e=>({...e})))}))}),[]),React.useEffect((()=>{let e=1*(t.end-t.begin)/350,a=C.map((a=>a.getzdata(t,e)));n(a)}),[t]);const o=React.useCallback((e=>{a((t=>{let a=t.end-t.begin;return{begin:t.begin-a*e,end:t.end-a*e}}))})),c=React.useCallback(((e,t)=>{a((a=>{let i=a.end-a.begin;if(e*i<300)return a;let l=a.begin+t*i;return{begin:l-e*(l-a.begin),end:l+e*(a.end-l)}}))})),u=React.useCallback((e=>{s(e)}));let h=Math.min(...i.map((e=>e.t.min))),m=Math.max(...i.map((e=>e.t.max))),d=Math.min(...i.map((e=>e.h.min))),f=Math.max(...i.map((e=>e.h.max))),g=86400*~~((r+10800)/86400)-10800;return React.createElement("div",{className:"wrapper_d20fbe7"},React.createElement("div",{className:"diagramsColumn_ebe3634"},React.createElement(R,{title:"Temperature, °C",timeInterval:t,onShift:o,onZoom:c,onSelectDate:u,min:h,max:m,width:350,height:k},i[0]&&React.createElement(v,{data:i[0].t.zdata,height:k,min:h,max:m,barw:1,color:"#ffa23c"}),i[1]&&React.createElement(v,{data:i[1].t.zdata,height:k,min:h,max:m,barw:1,color:"#88a23c"})),React.createElement(R,{title:"Humidity, %",timeInterval:t,onShift:o,onZoom:c,onSelectDate:u,min:d,max:f,width:350,height:k},i[0]&&React.createElement(v,{data:i[0].h.zdata,height:k,min:d,max:f,barw:1,color:"#bbb"}),i[1]&&React.createElement(v,{data:i[1].h.zdata,height:k,min:d,max:f,barw:1,color:"#88bbbb"}))),0!=r&&React.createElement(l,{isOpen:0!=r,title:"Set target temperature for Zone",onCancel:()=>{s(0)}},React.createElement(D,{title:new Date(1e3*r).toLocaleDateString()+" Z2 H",data:C[0].array[g].h?C[0].array[g].h.data:[],time:r})))}const M=[{id:1,temperature:14.1,targetTemperature:23.5,targetTemperatureDelta:.2,humidity:54.3,onControl:0,powerOn:0,sensorState:-3},{id:2,temperature:15.2,targetTemperature:21.2,targetTemperatureDelta:.1,humidity:48.1,onControl:0,powerOn:0,sensorState:-3},{id:3,temperature:5.9,targetTemperature:0,targetTemperatureDelta:0,humidity:85.1,onControl:0,powerOn:0,sensorState:-3}],_=new t("http://192.168.2.2"),S=new Date("2022.01.02 00:00:00")/1e3;function U(){const[a,i]=React.useState({version:"offline",unixtime:0,zones:M}),[l,n]=React.useState({begin:S-172800,end:S});React.useEffect((()=>{const e=Date.now()/1e3;let a;_.getInfo((l=>{i(t.parseInfo(l)),n({begin:e-172800,end:e}),a=setInterval((()=>{n((e=>({...e,end:Date.now()/1e3})))}),12e5)}));const l=setInterval((()=>{_.getInfo((e=>i(t.parseInfo(e))),(()=>i((e=>({...e,version:"offline"})))))}),1e4);return()=>{clearInterval(l),a&&clearInterval(a)}}),[]);const r=React.useCallback((e=>{_.setTemperature(e.id,e.targetTemperature,(()=>i((t=>({...t,zones:t.zones.map((t=>t.id==e.id?e:t))})))),(()=>i((t=>({...t,zones:t.zones.map((t=>t.id==e.id?{...t,targetTemperature:{}}:t))})))))})),s=React.useCallback((e=>{const t=e-1;a.zones[t].onControl?_.powerOff(e,(()=>i((t=>({...t,zones:t.zones.map((t=>t.id==e?{...t,onControl:0}:t))}))))):_.powerOn(e,(()=>i((t=>({...t,zones:t.zones.map((t=>t.id==e?{...t,onControl:1}:t))})))))}));return React.createElement("div",{className:"wrapper_d808929"},React.createElement(e,{firmware:a.version,controllerDateTime:new Date(1e3*a.unixtime).toLocaleTimeString()}),React.createElement("div",{className:"main_ef0bc9e"},React.createElement("div",{className:"controlsbox_d8af8a5"},a.zones.map(((e,t)=>React.createElement(h,{key:t,zone:e,onSetTemperature:r,onSetPowerControl:s})))),React.createElement("div",{className:"diagramsbox_e0be825"},React.createElement(x,{timeInterval:l})),React.createElement("div",{className:"info_bae79b0"},JSON.stringify(a))))}ReactDOM.render(React.createElement(U,null),document.getElementById("root"))})();